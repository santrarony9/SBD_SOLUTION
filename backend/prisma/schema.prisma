// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// USER MANAGEMENT
// --------------------------------------

enum Role {
  ADMIN
  STAFF
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(STAFF)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --------------------------------------
// MASTER DATA
// --------------------------------------

// 16K, 18K, 22K, 24K
model GoldPrice {
  id          String   @id @default(uuid())
  purity      Int      @unique // e.g. 22
  pricePer10g Float
  isActive    Boolean  @default(true)
  updatedAt   DateTime @updatedAt
}

// VVS1, VS1, SI1, etc.
model DiamondPrice {
  id            String   @id @default(uuid())
  clarity       String   @unique // e.g. "VVS1"
  pricePerCarat Float
  isActive      Boolean  @default(true)
  updatedAt     DateTime @updatedAt
}

// --------------------------------------
// DYNAMIC CHARGES
// --------------------------------------

enum ChargeType {
  FLAT
  PER_GRAM      // Usually for Gold Making Charges
  PER_CARAT     // Usually for Diamond
  PERCENTAGE    // e.g. for GST or heavy making charges
}

enum ApplyOn {
  GOLD_VALUE
  DIAMOND_VALUE
  SUBTOTAL      // (Gold + Diamond)
  FINAL_AMOUNT  // After other charges? Usually GST is on Subtotal + Making.
}

// Simplified logic: 
// Final Price = (GoldValue + DiamondValue) + Sum(Charges)
// Where each charge is calculated based on its Type and ApplyOn base.
// Note: GST is typically applied on the Total Taxable Value. 
// We will handle logic in service. 
// For ApplyOn: "SUBTOTAL" implies Gold+Diamond+Making? Or just Gold+Diamond?
// Let's refine ApplyOn to be explicitly: GOLD_VALUE, DIAMOND_VALUE, RAW_TOTAL (G+D), TAXABLE_VALUE (G+D+Making)

enum ChargeBasis {
  GOLD_WEIGHT   // For Per Gram
  DIAMOND_CARAT // For Per Carat
  GOLD_VALUE    // For % of Gold
  DIAMOND_VALUE // For % of Diamond
  RAW_TOTAL     // (GoldValue + DiamondValue) e.g. for general overhead %
  TAXABLE_VALUE // (GoldValue + DiamondValue + MakingCharges) - Used for GST
  FIXED         // Flat amount
}

model Charge {
  id          String      @id @default(uuid())
  name        String      // e.g. "Making Charges", "GST 3%"
  type        ChargeType  // FLAT, PER_GRAM, PER_CARAT, PERCENTAGE
  amount      Float       // The rate or fixed value
  
  // Who does this charge apply to?
  // We can use a simplified approach or powerful approach.
  // Let's stick to User Request: "Apply on: Gold, Diamond, Subtotal, Final amount"
  
  applyOn     ApplyOn
  
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

// --------------------------------------
// PRODUCTS
// --------------------------------------

model Product {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  
  // Core Specs
  goldPurity  Int      // 18, 22
  goldWeight  Float    // grams
  
  diamondClarity String // "VS1" - must match a DiamondPrice.clarity
  diamondCarat   Float
  diamondColor   String? // "E-F", "G-H"
  diamondCut     String? // "Excellent", "Very Good"
  
  // Certificate
  igiCertificateNumber String? 
  certificatePdf       String? // URL
  
  // Media
  images      String[] // Start with 2-5 images
  video       String?
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
